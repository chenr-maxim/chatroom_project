<html lang=en>
  <head>
    <meta charset=utf-8>
    <title>Chatkit demo</title>
  </head>
  <body>
      <ul id="message-list"></ul>
      <form id="message-form">
        <input type='text' id='message-text'>
        <input type="submit">
      </form>
    <script src="https://unpkg.com/@pusher/chatkit-client@1/dist/web/chatkit.js"></script>
    <script>
      const tokenProvider = new Chatkit.TokenProvider({
        url: "https://us1.pusherplatform.io/services/chatkit_token_provider/v1/c8cfadcc-721b-45c0-8d74-afa5e0d49452/token"
      });

      const chatManager = new Chatkit.ChatManager({
        instanceLocator: "v1:us1:c8cfadcc-721b-45c0-8d74-afa5e0d49452",
        //key: "e14a9168-5f4e-4d08-9e9f-56cefe8f0256:wNS8tHTBvfooEjGB2wy/mF3+OqL0DZstqKHu8AlzKA0="
        userId: "testuser2",
        tokenProvider: tokenProvider
      });

      const ROOM_ID = '12345'

      chatManager
        .connect()
          .then(currentUser => {
            console.log(currentUser.rooms);
            console.log(currentUser.roomSubscriptions);

            currentUser.subscribeToRoomMultipart({
            roomId: currentUser.rooms[0].id,
            hooks: {
              onMessage: message => {
                console.log("Received message:", message.parts[0].payload.content)
                document.write("Received message:", message.parts[0].payload.content, "\n")
              }
            },
            //messageLimit: 0
          });
        })
        .catch(error => {
          console.error("error:", error);
        });
    </script>
  </body>
</html>

